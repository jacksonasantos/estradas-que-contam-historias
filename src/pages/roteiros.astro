---
import BaseLayout from "../layouts/BaseLayout.astro";
import roteiros from "../data/roteiros"; // ajuste aqui para garantir importação correta
import RoteiroCard from "../components/RoteiroCard.astro";
import {
  Landmark,
  Mountain,
  Compass,
  Clapperboard,
  MountainSnow
} from "lucide-astro";
const categorias = [...new Set(roteiros.map(r => r.categoria))];
const iconMap = {
  "historicas": Landmark,
  "cenicas": Mountain,
  "tematicas": Compass,
  "cinematograficas": Clapperboard,
  "serras": MountainSnow
};
const categoriasCount = roteiros.reduce<Record<string, number>>(
  (acc, roteiro) => {
    acc[roteiro.categoria] = (acc[roteiro.categoria] || 0) + 1;
    return acc;
  },
  {}
);
const categoriaLabels = {
  "historicas": "Históricas",
  "cenicas": "Cênicas / Famosas",
  "tematicas": "Temáticas Especiais",
  "cinematograficas": "Cinematográficas",
  "serras": "Serras"
};
---

<BaseLayout>

  <!-- Cabeçalho -->
  <section class="px-6 md:px-20 py-12 max-w-4xl">
    <h1 class="text-5xl font-serif mb-6">Roteiros</h1>
    <p class="text-neutral-400 text-lg">
      Viagens de moto organizadas por tipo de experiência.
      Escolha a estrada que mais conversa com você.
    </p>
  </section>

  <!-- Filtro -->
<section class="px-6 md:px-20 pb-16">
  <div class="flex gap-3 flex-wrap">
    <button class="filter-btn active" data-filter="Todos">
      Todos ({roteiros.length})
    </button>
    {categorias.map(cat => {
      const Icon = iconMap[cat];
      const label = categoriaLabels[cat] ?? cat;
      return (
        <button
          class="filter-btn flex items-center gap-2"
          data-filter={cat}
        >
          {Icon && <Icon size={20} />}
          <span>{label} ({categoriasCount[cat] || 0})</span>
        </button>
      );
    })}
  </div>
</section>

  <!-- Lista -->
  <section class="px-6 md:px-20 pb-16">
    <ul
      id="roteiros-lista"
      class="grid grid-cols-1 md:grid-cols-3 gap-4 max-w-9xl"
    >
      {roteiros.map(r => (
        <li data-categoria={r.categoria ?? "Sem categoria"}>
          <RoteiroCard roteiro={r} />
        </li>
      ))}
    </ul>
  </section>

</BaseLayout>

<!-- JS mínimo -->
<script is:inline>
  document.addEventListener("DOMContentLoaded", () => {
    const buttons = document.querySelectorAll(".filter-btn");
    const items = document.querySelectorAll("#roteiros-lista li");

    buttons.forEach(btn => {
      btn.addEventListener("click", () => {
        buttons.forEach(b => b.classList.remove("active"));
        btn.classList.add("active");

        const filter = btn.getAttribute("data-filter");

        items.forEach(item => {
          const categoria = item.getAttribute("data-categoria") || "Sem categoria";

          item.style.display =
            filter === "Todos" || categoria === filter
              ? "block"
              : "none";
        });
      });
    });
  });
</script>