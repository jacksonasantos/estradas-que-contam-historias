---
import BaseLayout from "../layouts/BaseLayout.astro";
import roteiros from "../data/roteiros";
import CardRoteiro from "../components/CardRoteiro.astro";
import { CATEGORIAS } from "../data/categorias";

// total geral
const totalRoteiros = roteiros.length;
// categorias únicas
const categorias = [...new Set(roteiros.map(r => r.categoria))];
// contagem por categoria
const contagem = categorias.map(cat => ({
  nome: cat,
  total: roteiros.filter(r => r.categoria === cat).length
}));

// Gera um map para pegar o label e o ícone da categoria pelo id
const categoriaLabels = Object.fromEntries(CATEGORIAS.map(c => [c.id, c.label]));
const categoriaIcons = Object.fromEntries(CATEGORIAS.map(c => [c.id, c.icon]));
---

<BaseLayout title="Roteiros">
  <img
    src="/assets/hero.png"
    alt="Marca d'água"
    class="fixed inset-0 w-full h-full object-cover opacity-20 pointer-events-none z-0"
    style="top:0;left:0;"
  />

  <!-- Cabeçalho -->
  <section class="px-6 md:px-20 py-12 max-w-9xl flex items-center justify-between">
    <div>
      <h1 class="text-5xl font-serif mb-6">Roteiros</h1>
      <p class="text-neutral-400 text-lg">
        Viagens de moto organizadas por tipo de experiência.
        Escolha a estrada que mais conversa com você.
      </p>
    </div>
    <a
      href="/"
      class="flex items-center gap-2 border border-neutral-700 px-4 py-2 rounded-full hover:border-neutral-400 hover:text-white transition text-base" 
    >
      <span class="hidden md:inline">Voltar</span>
    </a>
  </section>

  <!-- Filtro -->
  <section class="px-6 md:px-20 pb-6">
    <div id="filtros" class="flex flex-wrap gap-4 overflow-x-auto scrollbar-hide py-2">
      <!-- Todos -->
      <button class="filter-btn active" data-filter="Todos">
        <span>Todos</span>
        <span class="count">{totalRoteiros}</span>
      </button>
      <!-- Categorias -->
      {contagem.map(cat => (
      <button class="filter-btn" data-filter={cat.nome}>
          {categoriaIcons[cat.nome] && (
            <img
              src={categoriaIcons[cat.nome]}
              alt={categoriaLabels[cat.nome] ?? cat.nome}
              width="16"
              height="16"
              class="inline-block mr-1 align-middle"
              style="filter: invert(80%) sepia(0%) saturate(0%) hue-rotate(0deg) brightness(90%) contrast(90%);"
            />
          )}
          <span>{categoriaLabels[cat.nome] ?? cat.nome}</span>
          <span class="count">{cat.total}</span>
      </button>
      ))}
    </div>
  </section>

  <!-- Lista -->
  <section class="px-6 md:px-20 pb-16">
    <ul id="roteiros-lista" class="grid grid-cols-1 md:grid-cols-3 gap-4 max-w-9xl">
      {roteiros.map(r => (
        <li data-categoria={r.categoria ?? "Sem categoria"}>
          <CardRoteiro roteiro={r} />
        </li>
      ))}
    </ul>
  </section>
</BaseLayout>

<!-- JS mínimo -->
<script is:inline>
  document.addEventListener("DOMContentLoaded", () => {
    const buttons = document.querySelectorAll(".filter-btn");
    const items = document.querySelectorAll("#roteiros-lista li");

    buttons.forEach(btn => {
      btn.addEventListener("click", () => {
        buttons.forEach(b => b.classList.remove("active"));
        btn.classList.add("active");

        const filter = btn.getAttribute("data-filter");

        items.forEach(item => {
          const categoria = item.getAttribute("data-categoria") || "Sem categoria";
          item.style.display =
            filter === "Todos" || categoria === filter
              ? "block"
              : "none";
        });
      });
    });
  });
</script>