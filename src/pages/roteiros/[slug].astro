---
import BaseLayout from "../../layouts/BaseLayout.astro";
import roteiros from "../../data/roteiros";
import { ICONS } from "../../data/icons";

// Função obrigatória para rotas dinâmicas Astro
export async function getStaticPaths() {
  return roteiros.map(r => ({
    params: { slug: r.slug },
  }));
}

// slug vindo da URL
const { slug } = Astro.params;
const roteiro = Array.isArray(roteiros)
  ? roteiros.find(r => (r.slug ?? "").trim() === slug)
  : undefined;
const experiencia = Array.isArray(roteiro?.experiencia) ? roteiro.experiencia : [];
const caminho = Array.isArray(roteiro?.caminho) ? roteiro.caminho : [];
const imagem = roteiro?.imagem ?? "";
const Icon = ICONS[roteiro?.categoria];
---

{roteiro ? (
  <BaseLayout title={`${roteiro.titulo} | Estradas que Contam Histórias`}>

    <!-- HERO -->
    <section class="relative min-h-[70vh] flex flex-col md:flex-row items-center px-6 md:px-20 pb-8">
      <div class="px-6 md:px-20 py-10 bg-neutral-900 rounded-lg shadow-lg mb-6 md:mb-0 md:mr-6 flex-1">
        <div class="flex items-center gap-3 mb-2">
          {Icon && <Icon size={32} class="text-neutral-300" />}
          <h1 class="text-4xl md:text-1xl font-serif wrap-break-word">
            {roteiro.titulo}
          </h1>
        </div>
        <p class="text-base mt-2 text-neutral-300 wrap-break-word">
          {roteiro.subtitulo}
        </p>
      </div>
      <div class="relative flex-1 w-full h-87.5 md:h-125 flex items-center justify-end">
        <img
          src={imagem}
          alt={roteiro.titulo}
          class="w-full h-full object-contain object-right rounded-lg shadow-lg"
          style="filter: brightness(0.7);"
        />
      </div>
    </section>

    <!-- INFO RÁPIDA -->
    <section class="px-6 md:px-20 py-6 border-b border-neutral-800">
      <div class="grid grid-cols-2 md:grid-cols-5 gap-4 text-lg text-center text-neutral-300">
        <div><strong>Duração</strong><br />{roteiro.duracao}</div>
        <div><strong>Distância</strong><br />{roteiro.distancia}</div>
        <div><strong>Região</strong><br />{roteiro.regiao}</div>
        <div><strong>Nível</strong><br />{roteiro.nivel}</div>
        <div><strong>Formato</strong><br />{roteiro.tipo}</div>
      </div>
    </section>

    <!-- HISTÓRIA -->
    <section class="px-6 md:px-20 py-10 max-w-7xl">
      <h2 class="text-xl font-serif mb-4">
        A história deste caminho
      </h2>
      <p class="text-neutral-300 leading-relaxed mb-2">
        {roteiro.historia}
      </p>
    </section>

    <!-- O CAMINHO -->
    <section class="px-6 md:px-20 py-10 bg-neutral-900">
      <h2 class="text-xl font-serif mb-4">
        O caminho
      </h2>
      <ul class="space-y-2 text-neutral-300 text-sm">
        {caminho.map(item => ( <li>• {item}</li> ))}
      </ul>
      <p class="mt-4 text-xs text-neutral-400">
        *O trajeto pode sofrer ajustes conforme clima ou proposta do grupo.*
      </p>
    </section>

    <!-- EXPERIÊNCIA -->
    <section class="px-6 md:px-20 py-10 max-w-3xl">
      <h2 class="text-xl font-serif mb-4">
        O que você vai viver
      </h2>
      <ul class="space-y-2 text-neutral-300 text-sm">
        {experiencia.map(item => ( <li>• {item}</li> ))}
      </ul>
    </section>

    <!-- CTA -->
    <section class="px-6 md:px-20 py-12 text-center border-t border-neutral-800">
      <h2 class="text-xl font-serif mb-4">
        Pronto para viver esta estrada?
      </h2>
      <a href="/contato"
         class="inline-block px-6 py-3 border border-neutral-100 hover:bg-neutral-100 hover:text-neutral-950 transition text-sm">
        Quero saber mais
      </a>
    </section>

  </BaseLayout>
) : (
  <BaseLayout title="Roteiro não encontrado | Estradas que Contam Histórias">
    <section class="px-6 md:px-20 py-24 text-center">
      <h1 class="text-4xl md:text-5xl font-serif mb-4">
        Roteiro não encontrado
      </h1>
      <p class="text-lg text-neutral-300">
        O roteiro solicitado não foi encontrado. Por favor, verifique o endereço ou escolha outro roteiro.
      </p>
    </section>
  </BaseLayout>
)}