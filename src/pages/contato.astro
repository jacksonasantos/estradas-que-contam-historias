---
import BaseLayout from "../layouts/BaseLayout.astro";
const FORMSPREE_URL = "https://formspree.io/f/xwkzqgqv"; // substitua pelo seu endpoint Formspree

let enviado = false;
let erro = "";

if (Astro.request.method === "POST") {
  const formData = await Astro.request.formData();
  const nome = formData.get("nome");
  const email = formData.get("email");
  const mensagem = formData.get("mensagem");

  const res = await fetch(FORMSPREE_URL, {
    method: "POST",
    headers: { "Accept": "application/json" },
    body: JSON.stringify({
      name: nome,
      email,
      message: mensagem,
      _replyto: "jackson_a_santos@hotmail.com"
    })
  });

  if (res.ok) {
    enviado = true;
  } else {
    erro = "Não foi possível enviar sua mensagem. Tente novamente.";
  }
}
---

<BaseLayout>

  <!-- Introdução -->
  <section class="px-6 md:px-20 py-32 max-w-4xl">
    <h1 class="text-4xl md:text-5xl font-serif mb-8">
      Vamos conversar?
    </h1>

    <p class="text-xl text-neutral-400 leading-relaxed">
      Algumas viagens começam com uma pergunta simples.
      Se você sente que um caminho está te chamando,
      este é o lugar para começar.
    </p>
  </section>

  <!-- Formulário -->
  <section class="px-6 md:px-20 py-24 bg-neutral-900">
    <div class="max-w-3xl">

      {enviado ? (
        <div class="text-green-400 mb-8">Mensagem enviada com sucesso!</div>
      ) : erro ? (
        <div class="text-red-400 mb-8">{erro}</div>
      ) : null}

      <form method="POST" class="grid grid-cols-1 gap-8">

        <div>
          <label class="block mb-2 text-sm text-neutral-400">
            Seu nome
          </label>
          <input
            type="text"
            name="nome"
            required
            placeholder="Como podemos te chamar?"
            class="w-full bg-transparent border-b border-neutral-600 focus:border-neutral-100 outline-none py-2"
          />
        </div>

        <div>
          <label class="block mb-2 text-sm text-neutral-400">
            Email
          </label>
          <input
            type="email"
            name="email"
            required
            placeholder="Para responder a conversa"
            class="w-full bg-transparent border-b border-neutral-600 focus:border-neutral-100 outline-none py-2"
          />
        </div>

        <div>
          <label class="block mb-2 text-sm text-neutral-400">
            Mensagem
          </label>
          <textarea
            name="mensagem"
            rows="4"
            required
            placeholder="Conte um pouco do que você está buscando na estrada"
            class="w-full bg-transparent border-b border-neutral-600 focus:border-neutral-100 outline-none py-2 resize-none"
          ></textarea>
        </div>

        <button
          type="submit"
          class="mt-8 border border-neutral-100 px-8 py-4 hover:bg-neutral-100 hover:text-neutral-950 transition self-start"
        >
          Enviar mensagem
        </button>

      </form>

    </div>
  </section>

  <!-- Fechamento -->
  <section class="px-6 md:px-20 py-24 max-w-4xl">
    <p class="text-neutral-400 font-serif text-lg">
      Não existe pergunta errada.
      Toda boa viagem começa com curiosidade.
    </p>
  </section>

</BaseLayout>
